# CallCops: Real-Time Audio Watermarking Configuration
# ==========================================================
# 한국어 상담 데이터 (8kHz) 최적화 설정

# 오디오 규격
audio:
  sample_rate: 8000          # 8kHz (전화망 표준)
  bit_depth: 16              # 16-bit PCM
  channels: 1                # Mono
  frame_ms: 40               # 40ms 프레임 (320 samples @ 8kHz)
  frame_samples: 320         # 8000 * 0.040 = 320

# 워터마크 페이로드
watermark:
  bits_per_frame: 1          # 프레임당 1-bit 삽입
  payload_length: 128        # 128-bit Cyclic Payload
  sync_pattern: "1010101010101010"  # 16-bit 동기화 패턴

# 모델 아키텍처
model:
  encoder:
    channels: [32, 64, 128, 256]      # Causal Conv 채널
    kernel_size: 7                     # 컨볼루션 커널 크기
    dilation_base: 2                   # Dilation 증가 배수
    num_layers: 8                      # 총 레이어 수
    attention_heads: 4                 # Attention 헤드 수

  decoder:
    channels: [256, 128, 64, 32]      # 역순 채널
    kernel_size: 5

  discriminator:
    resolutions: [64, 128, 256]       # Multi-Resolution scales
    channels: [32, 64, 128, 256]

# 학습 설정

# batch_size 32, num_workers 16 -> batch_size 24, num_workers 4 (메모리 절약, 줄이지 않으면 OOM 발생)
training:
  batch_size: 24             # 실행 스크립트 설정값
  learning_rate: 0.00001     # 5e-5 → 1e-5 (안정화)
  num_workers: 4            # 실행 스크립트 설정값
  adam_betas: [0.5, 0.9]
  epochs: 100
  grad_clip: 1.0
  use_amp: true              # Mixed Precision (BF16 적용됨)

  # 손실 함수 가중치 (Audio Priority for Smooth Perturbation)
  # 목표: 소리가 깨지지 않게(Smooth) 먼저 학습하고, 비트는 천천히 채움
  lambda_bit: 2.0            # 5.0 → 2.0 (비트 압박 완화)
  lambda_audio: 50.0         # 10.0 → 50.0 (음질 최우선)
  lambda_stft: 10.0          # 5.0 → 10.0 (스펙트럼 보존)
  lambda_l1: 1.0             # 30.0 → 1.0 (L1 과다 억제 방지, Mel로 대체)
  lambda_adv: 0.05           # L_GAN (안정성)
  lambda_det: 0.1            # L_Det (탐지 정확도)

# 코덱 시뮬레이터
codec:
  enabled: true              # 코덱 강건성 학습 활성화!
  types: ["g711_alaw", "g711_ulaw", "g729", "amr_nb", "none"]  # AMR-NB 추가!
  g711_bits: 8               # 8-bit 양자화
  g729_bitrate: 8000         # 8kbps

# 데이터 증강
augmentation:
  noise_snr_range: [15, 40]  # dB
  bandpass_low: 300          # Hz (전화망 대역)
  bandpass_high: 3400        # Hz
  codec_prob: 0.7            # 코덱 적용 확률

# 품질 목표
quality_targets:
  pesq_min: 4.0              # PESQ >= 4.0
  ber_max: 0.05              # BER < 5%
  latency_max_ms: 200        # 실시간 요구사항